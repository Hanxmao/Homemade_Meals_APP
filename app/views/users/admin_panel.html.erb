
<div class="container mt-5">

<div class="d-flex flex-row justify-content-around">
    <%= link_to "#{Notification.unread_count(current_user)} Notifications", notifications_path%>
    <div class="container">
        <h2 class="text-center fw-bold"><%=@user.username%>'s Admin Panel</h2>  
    </div>

    <div class="d-flex flex-row justify-content-around">
        <div class="card p-4 m-2" id="user_profile_container">
            <img src="<%= @user.profile_img_url%>">
            <div id="user_profile_infomation">
                <p><strong>Name: </strong><%=@user.username%></p>
                <p><strong>Email: </strong><%=@user.email%></p>
                <% if(@user.meals) %>
                    <p><strong>Meals Number: </strong><%=@user.meals.count%></p>
                <% end %>
                <% if(@user.reviews) %>
                    <p><strong>Reviews Number: </strong><%=@user.reviews.count%></p>
                <% end %>
                <% if @user.is_cook%>
                <%= button_to "Create a New Meal", new_meal_path, method: :get, class: "btn btn-dark my-3"%>
                <% end %>
            </div>
        </div>


        <div class="container m-2">
            <% if (@user.is_cook) %>
                <div class="card p-4" id="user_container">
                    <h5 class="fw-bold ms-1">Current Meals</h5>
                    <br>
                    <%if(@user.meals.count == 0) %>
                        <p>You don't have any meals yet!</p>
                        <%= button_to "Create Your First Meal Now!", new_meal_path, method: :get, class: "btn btn-outline-dark my-3"%>
                    <% else %>
                        <div class="d-flex flex-column flex-wrap justify-content-center">
                        <%@meals = @user.meals%>
                        <% @meals.each do |meal| %>
                            <div class="card mx-2" style="40em">
                                <img src="<%= meal.img_url%>" class="card-img-top" alt="">
                                <div class="card-body">
                                    <h5 class="card-title text-center"><a href="<%=meal_path(meal)%>" class="text-decoration-none text-dark"><%= meal.title%></a></h5>
                                    <p class="card-text text-truncate text-center"><%= meal.description%></p>

                                    <% if can? :crud, meal %>
                                    <div class="container d-flex flex-row">
                                        <%= button_to "Edit", edit_meal_path(meal), method: :get, class: "btn btn-outline-dark"%>
                                        <%= button_to "Delete", meal_path(meal), method: :delete, form: {data: {turbo_confirm: 'Are you sure?'}}, class:"btn btn-outline-dark ms-2"%>
                                    </div>
                                    <% end %>
                                </div>
                            </div>
                        <% end %>
                        </div>
                    <% end %>

                </div>
            <%else%>
                <div class="container d-flex flex-column card mb-4">
                    <div class=" d-flex flex-column justify-content-center">
                        <h2 class="mt-4 fw-bold text-center">Your Reviews</h2>
                    </div>
                     <%@approved_reviews = @user.reviews.select{|x| x.is_approved}%>
                     <%@pending_reviews = @user.reviews.select{|x| !x.is_approved}%>
                    <div class="row row-cols-2 ms-3 justify-content-center">
                        <p>Approved Reviews</p>
                        <% @approved_reviews.each do |review| %>
                            <div class="card col m-3 py-3" style="width: 40em">
                                <div class="card-body">
                                    <h4 class="card-title fw-bold"><a href="<%=meal_path(review.meal)%>" class="text-dark"><%= review.meal.title%></a></h4>
                                    <hr>
                                    <span><strong>Rating: </strong>
                                        <%review.rating.times do %>
                                            ★
                                        <% end %>
                                    </span>
                                    <p class="card-text text-truncate"><%= review.body%></p>
                                    <span class="d-flex flex-row align-items-end"><small style="font-size: 12px;"> Posted at <%= review.created_at%> </small>
                                    <% if can? :crud, review %>
                                        <%= button_to "Delete", meal_review_path(review.meal, review), method: :delete, form: {data: {turbo_confirm: 'Are you sure?'}}, class:"btn btn-sm btn-outline-dark me-2 mx-1"%>
                                    <% end %>
                                </div>
                            </div>
                        <% end %>
                    </div>
                    
                    
                   <div class="row row-cols-2 ms-3 justify-content-center">
                        <p>Pending Reviews</p>
                        <% @pending_reviews do |review| %>
                            <div class="card col m-3 py-3" style="width: 40em">
                                <div class="card-body">
                                    <h4 class="card-title fw-bold"><a href="<%=meal_path(review.meal)%>" class="text-dark"><%= review.meal.title%></a></h4>
                                    <hr>
                                    <span><strong>Rating: </strong>
                                        <%review.rating.times do %>
                                            ★
                                        <% end %>
                                    </span>
                                    <p class="card-text text-truncate"><%= review.body%></p>
                                    <span class="d-flex flex-row align-items-end"><small style="font-size: 12px;"> Posted at <%= review.created_at%> </small>
                                    <% if can? :crud, review %>
                                        <%= button_to "Delete", meal_review_path(review.meal, review), method: :delete, form: {data: {turbo_confirm: 'Are you sure?'}}, class:"btn btn-sm btn-outline-dark me-2 mx-1"%>
                                    <% end %>
                                </div>
                            </div>
                        <% end %>
                    </div>
                    
                    
                </div>

                <div class="container d-flex flex-column card">
                    <div class="d-flex flex-row justify-content-center">
                        <h2 class="mt-4 fw-bold">Your Orders</h2>
                    </div>
                    <%@orders = @user.orders%>
                    <div class="row row-cols-2 ms-3 justify-content-center">
                        <% @orders.each do |order| %>
                            <div class="card col m-4 py-3" style="width:40em">
                                <div class="card-body">
                                    <h4><a href="<%=order_path(order)%>" class="text-dark fw-bold">Order ID#<%= order.id%></a></h4>
                                    <hr>
                                    <h4 class="card-title"><%= order.meal.title %></h4>
                                    <p>Cook: <%= order.meal.user.username %></p>
                                    <p>$ <%= order.meal.price%></p>
                                    <p>Date: <%= order.created_at %></p>
                                </div>
                            </div>
                        <% end %>
                    </div>
                </div>
            <%end%>
        </div>
    </div>

</div>